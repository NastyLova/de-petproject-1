# Витрина RFM

## 1.1. Выясните требования к целевой витрине.

Постановка задачи выглядит достаточно абстрактно - постройте витрину. Первым делом вам необходимо выяснить у заказчика детали. Запросите недостающую информацию у заказчика в чате.

Зафиксируйте выясненные требования. Составьте документацию готовящейся витрины на основе заданных вами вопросов, добавив все необходимые детали.

-----------

{Необходимо построить витрину для RFM-классификации. Для анализа нужно отобрать только успешно выполненные заказы (успешным заказом считается заказ со стратусом Closed).
RFM (от англ. Recency, Frequency, Monetary Value) — способ сегментации клиентов, при котором анализируют их лояльность: как часто, на какие суммы и когда в последний раз тот или иной клиент покупал что-то. На основе этого выбирают клиентские категории, на которые стоит направить маркетинговые усилия. 
Каждого клиента оценивают по трём факторам:
	Recency (пер. «давность») — сколько времени прошло с момента последнего заказа.
	Frequency (пер. «частота») — количество заказов.
	Monetary Value (пер. «денежная ценность») — сумма затрат клиента
Витрина должна лежать в схеме analysis. Наименование должно быть dm_rfm_segments.
Структура витрины:
	- user_id
	- recency (число от 1 до 5)
	- frequency (число от 1 до 5)
	- monetary_value (число от 1 до 5)
В витрине нужны данные с начала 2022 года. Обновления не нужны.
Без разницы: если количество заказов одинаковое, то неважно, кого поставить выше, а кого ниже. Аналогично и с другими показателями.}



## 1.2. Изучите структуру исходных данных.

Полключитесь к базе данных и изучите структуру таблиц.

Если появились вопросы по устройству источника, задайте их в чате.

Зафиксируйте, какие поля вы будете использовать для расчета витрины.

-----------

{
Для витрины потребуются следующие источники (таблицы):
	- production.orders - информация клиенте, о сумме, количестве и дате заказа
	- production.orderstatuses - информация о статусе заказа

Из источников потребуются следующие атрибуты:
production.orders	user_id			идентификато клиента
production.orders	order_ts		дата и время заказа для нахождения даты последнего заказа
production.orders	order_id		уникальный идентификатор заказа для сбора кол-ва заказов по клиенту
production.orders	payment			сумма платежа по заказу для нахождения общей суммы заказов по клиенту 
production.orders	status			статус заказа для фильтрации только успешных заказов

}


## 1.3. Проанализируйте качество данных

Изучите качество входных данных. Опишите, насколько качественные данные хранятся в источнике. Так же укажите, какие инструменты обеспечения качества данных были использованы в таблицах в схеме production.

-----------

{
Задание выполнено в файле data_quality.md
}


## 1.4. Подготовьте витрину данных

Теперь, когда требования понятны, а исходные данные изучены, можно приступить к реализации.

### 1.4.1. Сделайте VIEW для таблиц из базы production.**

Вас просят при расчете витрины обращаться только к объектам из схемы analysis. Чтобы не дублировать данные (данные находятся в этой же базе), вы решаете сделать view. Таким образом, View будут находиться в схеме analysis и вычитывать данные из схемы production. 

Напишите SQL-запросы для создания пяти VIEW (по одному на каждую таблицу) и выполните их. Для проверки предоставьте код создания VIEW.

Скрипт в файле views.sql
```SQL
--Впишите сюда ваш ответ

```

### 1.4.2. Напишите DDL-запрос для создания витрины.**

Далее вам необходимо создать витрину. Напишите CREATE TABLE запрос и выполните его на предоставленной базе данных в схеме analysis.

Скрипт в файле datamart_ddl.sql
```SQL
--Впишите сюда ваш ответ

```

### 1.4.3. Напишите SQL запрос для заполнения витрины

Наконец, реализуйте расчет витрины на языке SQL и заполните таблицу, созданную в предыдущем пункте.

Для решения предоставьте код запроса.

Решения в файлах tmp_rfm_recency.sql, tmp_rfm_monetary_value.sql, tmp_rfm_frequency.sql, datamart_query.sql
```SQL
--Впишите сюда ваш ответ

```



